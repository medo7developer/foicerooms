# ุญููู ูุดุงูู ุชุณุฑุจ ุงูุฐุงูุฑุฉ ูุชุนุทู ุงูุชุทุจูู ูู WebRTC

## ุงููุดุงูู ุงููุญูููุฉ:

### ๐ฅ 1. ูุดููุฉ ุชุณุฑุจ ุงูุฐุงูุฑุฉ ุงูุฑุฆูุณูุฉ
**ุงููุดููุฉ:** 
```
W/libc (24695): pthread_create failed: couldn't allocate 1069056-bytes mapped space: Out of memory
F/libc (24695): Fatal signal 6 (SIGABRT), code -1 (SI_QUEUE)
```

**ุงูุณุจุจ:** ุฅูุดุงุก peer connections ูุชุนุฏุฏุฉ ุจุฏูู ุฅุบูุงู ุงูุณุงุจูุฉุ ููุง ูุคุฏู ุฅูู:
- ุชุฑุงูู NetworkMonitor threads
- ุชุณุฑุจ ููุงุฑุฏ WebRTC
- ุงุณุชูุฒุงู ุฐุงูุฑุฉ ุงููุธุงู

**ุงูุญู:**
- โ ุฅุถุงูุฉ ุชูุธูู ุดุงูู ูุจู ุฅูุดุงุก ุฃู ุงุชุตุงู ุฌุฏูุฏ
- โ ูุนุงูุฌุฉ ููุฑูุฉ ููุงุชุตุงูุงุช ุงููุบููุฉ
- โ ุฏูุงู ุชูุธูู ุขููุฉ ูุน ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### ๐ฅ 2. ุฅุตูุงุญ ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ
**ุงููุดููุฉ:** ูุญุงููุงุช ูุชุนุฏุฏุฉ ุณุฑูุนุฉ ุจุฏูู ุชูุธูู ููุงุณุจ

**ุงูุญู:**
- โ ุชูุธูู ููู ูุจู ูู ูุญุงููุฉ ุฌุฏูุฏุฉ
- โ ูุชุฑุงุช ุงูุชุธุงุฑ ุฃุทูู ุจูู ุงููุญุงููุงุช
- โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก ูุน ุชูุธูู ูุณุฑู

### ๐ฅ 3. ุชุญุณูู ุฅุนุฏุงุฏุงุช STUN/TURN
**ุงูุชุญุณููุงุช:**
- โ ุชูููู iceCandidatePoolSize ูู 15 ุฅูู 10 ูุชูููุฑ ุงูุฐุงูุฑุฉ
- โ ุชูููู timeout ูู 30 ุซุงููุฉ ุฅูู 20 ุซุงููุฉ
- โ ุฅุถุงูุฉ ุญุฏ ุฃูุตู ููู bitrate (32000)
- โ ุชุญุณูู ุฅุนุฏุงุฏุงุช ping intervals

### ๐ฅ 4. ูุนุงูุฌุฉ ุฃุฎุทุงุก addTrack
**ุงูุชุญุณููุงุช:**
- โ ูุญุต ุดุงูู ูุญุงูุฉ ุงูุงุชุตุงู ูุจู addTrack
- โ ูุนุงูุฌุฉ ูุญุฏุฏุฉ ูุฃุฎุทุงุก "C++ addTrack failed"
- โ ุชุฌูุจ ุฅุถุงูุฉ ูุณุงุฑุงุช ููุฑุฑุฉ
- โ timeout ูุญุฏุฏ ูุนูููุฉ addTrack

### ๐ฅ 5. ุฅุฏุงุฑุฉ ุฏูุฑุฉ ุงูุญูุงุฉ
**ุงูุชุญุณููุงุช:**
- โ ุฏุงูุฉ cleanupAllConnections ุดุงููุฉ
- โ ุชูุธูู ุนูุฏ dispose ูู GameScreen
- โ ุชูุธูู ุนูุฏ ูุบุงุฏุฑุฉ ุงููุนุจุฉ
- โ ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก ูู ุงูุชูุธูู

## ุงููููุงุช ุงููุญุฏุซุฉ:

### 1. `lib/services/webrtc_services/webrtc_connection_manager.dart`
```dart
// ุฅุถุงูุงุช ุฑุฆูุณูุฉ:
- _cleanupExistingConnection() // ุชูุธูู ุดุงูู ูุจู ุงูุฅูุดุงุก
- _immediateCleanup() // ุชูุธูู ููุฑู ููููุงุฑุฏ  
- _forceCleanup() // ุชูุธูู ูุณุฑู ูู ุงูุฃุฎุทุงุก
- cleanupAllConnections() // ุชูุธูู ุฌููุน ุงูุงุชุตุงูุงุช
- ุชุญุณูู ุฅุนุฏุงุฏุงุช STUN/TURN ููุฐุงูุฑุฉ
- ูุนุงูุฌุฉ RTCPeerConnectionStateClosed ู RTCIceConnectionStateClosed
```

### 2. `lib/screens/game_screen.dart`
```dart
// ุชุญุณููุงุช:
- ุชูุธูู ุดุงูู ูุจู ุฅูุดุงุก connections ุฌุฏูุฏุฉ
- ูุชุฑุงุช ุงูุชุธุงุฑ ุฃุทูู ุจูู ุงููุญุงููุงุช (2 ุซุงููุฉ)
- ูุนุงูุฌุฉ ุฃููู ููุฃุฎุทุงุก ูุน ุชูุธูู
- ุชุญุฏูุซ dispose() ูุน ุชูุธูู WebRTC ุขูู
```

### 3. `lib/services/webrtc_services/webrtc_service.dart`
```dart
// ุฅุถุงูุงุช:
- cleanupAllConnections() // ุฏุงูุฉ ุชูุธูู ุนุงูุฉ
- ุชุญุณูู dispose() ูุน ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
```

### 4. `lib/widgets/game/game_screen_mixin.dart`
```dart
// ุชุญุณููุงุช:
- ุชูุธูู WebRTC ุนูุฏ ูุบุงุฏุฑุฉ ุงููุนุจุฉ
- ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก ูู ุงูุชูุธูู
```

### 5. `lib/services/webrtc_services/webrtc_audio_manager.dart`
```dart
// ุชุญุณููุงุช:
- ูุนุงูุฌุฉ ุดุงููุฉ ูุฃุฎุทุงุก addTrack
- ูุญุต ุญุงูุฉ ุงูุงุชุตุงู ูุจู addTrack
- ุชุดุฎูุต ููุตู ููุฃุฎุทุงุก
```

## ุงูุชุญุณููุงุช ุงูุฃุณุงุณูุฉ:

### ๐ง ูุจู ุงูุฅุตูุงุญ:
```
โ ุฅูุดุงุก peer connections ุจุฏูู ุชูุธูู ุงูุณุงุจูุฉ
โ NetworkMonitor threads ูุชุฑุงููุฉ
โ Out of memory errors
โ ุชุนุทู ุงูุชุทุจูู ุนูุฏ ุงูุถูุงู ูุณุชุฎุฏู ุซุงู
```

### โ ุจุนุฏ ุงูุฅุตูุงุญ:
```
โ ุชูุธูู ุดุงูู ูุจู ูู ุงุชุตุงู ุฌุฏูุฏ
โ ุฅุฏุงุฑุฉ ุขููุฉ ููููุงุฑุฏ
โ ูุนุงูุฌุฉ ูููุฉ ููุฃุฎุทุงุก
โ ุชูููู ุงุณุชููุงู ุงูุฐุงูุฑุฉ
โ ุงุณุชูุฑุงุฑ ุงูุชุทุจูู
```

## ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:

1. **ุชุดุบูู ุงูุชุทุจูู:**
```bash
cd /home/user/webapp
flutter clean
flutter pub get
flutter run
```

2. **ุงุฎุชุจุงุฑ ุงูุณููุงุฑูู ุงููุดูู:**
- ุฅูุดุงุก ุบุฑูุฉ ูู ูุณุชุฎุฏู ุฃูู
- ุงูุถูุงู ูุณุชุฎุฏู ุซุงู ููุบุฑูุฉ
- ูุฑุงูุจุฉ logs ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก memory
- ุงูุชุฃูุฏ ูู ุนูู ุงูุฏุฑุฏุดุฉ ุงูุตูุชูุฉ

3. **ููุงุญุธุฉ ุงูุชุญุณููุงุช:**
- ุนุฏู ูุฌูุฏ ุฑุณุงุฆู "Out of memory"
- ุนุฏู ุชุนุทู ุงูุชุทุจูู
- ุชูุธูู ููุงุฑุฏ WebRTC ุจุดูู ุตุญูุญ
- ุงุณุชูุฑุงุฑ ุงูุงุชุตุงูุงุช ุงูุตูุชูุฉ

## ุงููุชูุฌุฉ ุงููุชููุนุฉ:

๐ฏ **ูุฏู ุงูุฅุตูุงุญ:** ุญู ูุดููุฉ ุชุณุฑุจ ุงูุฐุงูุฑุฉ ูุชุนุทู ุงูุชุทุจูู ููุงุฆูุงู

โ **ุงููุชุงุฆุฌ:**
- ุงูุชุทุจูู ูุง ูุชุนุทู ุนูุฏ ุงูุถูุงู ูุณุชุฎุฏู ุซุงู
- ุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ูุณุชูุฑ ููุญุฏูุฏ
- ุฏุฑุฏุดุฉ ุตูุชูุฉ ุชุนูู ุจุดูู ุตุญูุญ
- ูุนุงูุฌุฉ ุขููุฉ ูุฌููุน ุงูุฃุฎุทุงุก ุงููุญุชููุฉ
- ุชูุธูู ุดุงูู ููููุงุฑุฏ ุนูุฏ ุงูุฅุบูุงู

โก **ุชุญุณููุงุช ุงูุฃุฏุงุก:**
- ุชูููู ุงุณุชููุงู ุงูุฐุงูุฑุฉ ุจูุณุจุฉ ูุจูุฑุฉ
- ุงุณุชุฌุงุจุฉ ุฃุณุฑุน ููุงุชุตุงูุงุช
- ูุนุงูุฌุฉ ุฃุฐูู ููุฃุฎุทุงุก
- ุฅุฏุงุฑุฉ ุฃูุถู ูุฏูุฑุฉ ุญูุงุฉ ุงูููุงุฑุฏ